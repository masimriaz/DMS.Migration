<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Data Migration Platform</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="~/images/favicon.svg">

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- AdminLTE CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/site-custom.css" />

    <style>
        /* Fix tenant selector dropdown visibility */
        .navbar-nav .dropdown-menu {
            z-index: 1050;
        }

        /* Ensure sidebar transitions work */
        .main-sidebar {
            transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out;
        }

        /* Fix sidebar collapse on mobile */
        @@media (max-width: 991.98px) {
            .sidebar-collapse .main-sidebar {
                margin-left: -250px;
            }
        }
    </style>

    @RenderSection("Styles", required: false)
</head>

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="/" class="nav-link">Home</a>
                </li>
            </ul>

            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Tenant Selector -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#" style="padding-right: 15px;">
                        <i class="fas fa-building mr-2"></i>
                        <span>Production Environment</span>
                        <i class="fas fa-angle-down ml-2"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <a href="#" class="dropdown-item active">
                            <i class="fas fa-check mr-2"></i> Production Environment
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-building mr-2"></i> UAT Environment
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-building mr-2"></i> Client Demo Tenant
                        </a>
                    </div>
                </li>

                <!-- Notifications Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge">3</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <span class="dropdown-item dropdown-header">3 Notifications</span>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-check mr-2"></i> Migration completed
                            <span class="float-right text-muted text-sm">3 mins</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-exclamation-triangle mr-2"></i> 2 items failed
                            <span class="float-right text-muted text-sm">2 hours</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
                    </div>
                </li>

                <!-- User Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-user"></i>
                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            <span class="d-none d-md-inline ml-1">@User.Identity.Name</span>
                        }
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        @if (User.Identity?.IsAuthenticated == true)
                        {
                            <div class="dropdown-item dropdown-header">
                                <strong>@(User.FindFirst("FullName")?.Value ?? User.Identity.Name ?? "User")</strong>
                                <br />
                                <small
                                    class="text-muted">@User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value</small>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="/Profile" class="dropdown-item">
                                <i class="fas fa-user mr-2"></i> Profile
                            </a>
                            <a href="/Settings" class="dropdown-item">
                                <i class="fas fa-cog mr-2"></i> Settings
                            </a>
                            <div class="dropdown-divider"></div>
                            <form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="dropdown-item">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Sign out
                                </button>
                            </form>
                        }
                        else
                        {
                            <a href="/Account/Login" class="dropdown-item">
                                <i class="fas fa-sign-in-alt mr-2"></i> Sign in
                            </a>
                        }
                    </div>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="/" class="brand-link" style="padding: 0.8rem 1rem;">
                <img src="~/images/logo-icon.svg" alt="Data Migration" class="brand-image"
                    style="opacity: 1; max-height: 40px; width: auto;">
                <span class="brand-text"
                    style="font-weight: 700; font-size: 1.1rem; color: #FFFFFF; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">Data
                    Migration</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user panel -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <div class="image">
                            @{
                                var fullName = User.FindFirst("FullName")?.Value ?? User.Identity.Name ?? "User";
                                var initials = string.Join("", fullName.Split(' ', StringSplitOptions.RemoveEmptyEntries)
                                .Take(2)
                                .Select(word => char.ToUpper(word[0])));
                            }
                            <div class="img-circle elevation-2"
                                style="width: 34px; height: 34px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                @initials
                            </div>
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">@(User.FindFirst("FullName")?.Value ?? User.Identity.Name)</a>
                            <small class="text-muted">@User.FindFirst("TenantName")?.Value</small>
                        </div>
                    }
                    else
                    {
                        <div class="image">
                            <div class="img-circle elevation-2"
                                style="width: 34px; height: 34px; background: #6c757d; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                ?
                            </div>
                        </div>
                        <div class="info">
                            <a href="/Account/Login" class="d-block">Guest User</a>
                        </div>
                    }
                </div>

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false">

                        <!-- Dashboard -->
                        <li class="nav-item">
                            <a href="/"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Home" && ViewContext.RouteData.Values["Action"]?.ToString() == "Index" ? "active" : "")">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>Dashboard</p>
                            </a>
                        </li>

                        <!-- Migration Section -->
                        <li class="nav-header">MIGRATION</li>
                        <li class="nav-item">
                            <a href="/Connections/Index"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Connections" ? "active" : "")">
                                <i class="nav-icon fas fa-plug"></i>
                                <p>Connections</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/Discovery/Index"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Discovery" ? "active" : "")">
                                <i class="nav-icon fas fa-search"></i>
                                <p>Discovery</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/Plans"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Plans" ? "active" : "")">
                                <i class="nav-icon fas fa-sitemap"></i>
                                <p>Plans</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/Jobs"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Jobs" ? "active" : "")">
                                <i class="nav-icon fas fa-tasks"></i>
                                <p>Migration Jobs</p>
                            </a>
                        </li>

                        <!-- Quality Section -->
                        <li class="nav-header">QUALITY</li>
                        <li class="nav-item">
                            <a href="/Validation"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Validation" ? "active" : "")">
                                <i class="nav-icon fas fa-check-circle"></i>
                                <p>Validation</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/Reports"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Reports" ? "active" : "")">
                                <i class="nav-icon fas fa-chart-bar"></i>
                                <p>Reports</p>
                            </a>
                        </li>

                        <!-- System Section -->
                        <li class="nav-header">SYSTEM</li>
                        <li class="nav-item">
                            <a href="/SystemInfo"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "SystemInfo" ? "active" : "")">
                                <i class="nav-icon fas fa-server"></i>
                                <p>
                                    System Info
                                    <span class="badge badge-info right">NEW</span>
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/Admin"
                                class="nav-link @(ViewContext.RouteData.Values["Controller"]?.ToString() == "Admin" ? "active" : "")">
                                <i class="nav-icon fas fa-cogs"></i>
                                <p>Administration</p>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            @if (!string.IsNullOrEmpty(ViewData["Title"]?.ToString()))
            {
                <div class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1 class="m-0">@ViewData["Title"]</h1>
                                @if (ViewData["Subtitle"] != null)
                                {
                                    <p class="text-muted">@ViewData["Subtitle"]</p>
                                }
                            </div>
                            <div class="col-sm-6">
                                @if (ViewData["Breadcrumb"] != null)
                                {
                                    <ol class="breadcrumb float-sm-right">
                                        @Html.Raw(ViewData["Breadcrumb"])
                                    </ol>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    @RenderBody()
                </div>
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->

        <!-- Footer -->
        <footer class="main-footer">
            <strong>Copyright &copy; 2025 <a href="/">Data Migration Platform</a>.</strong>
            All rights reserved.
            <div class="float-right d-none d-sm-inline-block">
                <b>Version</b> 2.5.1 | <span class="badge badge-success">Development</span>
            </div>
        </footer>
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap 4 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- AdminLTE App -->
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

    <!-- Custom JS -->
    <script src="~/js/site.js"></script>
    <!-- Toast Script -->
    <script src="~/js/toast.js"></script>

    <script>
        $(document).ready(function () {
            // Initialize AdminLTE
            $('[data-widget="pushmenu"]').PushMenu();

            // Fix dropdown toggle for Bootstrap 4
            $('.dropdown-toggle').dropdown();

            // Tenant selector - update text when clicked
            $('.dropdown-menu a:not(.dropdown-footer)').on('click', function (e) {
                if ($(this).closest('.nav-item').find('.fa-building').length > 0) {
                    e.preventDefault();
                    var selectedText = $(this).text().trim();
                    $(this).closest('.nav-item').find('span:first').text(selectedText);
                    $(this).closest('.dropdown-menu').find('.active').removeClass('active');
                    $(this).addClass('active');
                }
            });
        });
        <!-- Toast Host -->
        @await Html.PartialAsync("_ToastHost")

    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>

</html>